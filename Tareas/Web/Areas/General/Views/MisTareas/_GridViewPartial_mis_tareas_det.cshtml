@using System.Web.UI.WebControls;

@Html.DevExpress().GridView(settings =>
{

    settings.SettingsDetail.MasterGridName = "grid";
    settings.CallbackRouteValues = new { Controller = "MisTareas", Action = "GridViewPartial_mis_tareas_det", IdTarea = ViewBag.IdTarea };
    settings.Width = Unit.Percentage(100);


    var Secuancia = "";
    settings.HtmlRowPrepared = (s, e) =>
    {
        Secuancia = Convert.ToString(e.GetValue("Secuancial"));
    };
    settings.Name = "GridViewPartial_mis_tareas_det" + ViewBag.IdTarea + Secuancia;



    settings.SettingsEditing.Mode = GridViewEditingMode.EditFormAndDisplayRow;
    settings.SettingsEditing.UpdateRowRouteValues = new { Controller = "MisTareas", Action = "EditingUpdate", Area = "General" , IdTarea =ViewBag.IdTarea };
    settings.CommandColumn.Visible = true;

    //CConfiguracion responsive
    settings.SettingsAdaptivity.AdaptivityMode = GridViewAdaptivityMode.HideDataCellsWindowLimit;
    settings.SettingsAdaptivity.AdaptiveColumnPosition = GridViewAdaptiveColumnPosition.Right;
    settings.SettingsAdaptivity.AdaptiveDetailColumnCount = 1;
    settings.SettingsAdaptivity.AllowOnlyOneAdaptiveDetailExpanded = false;
    settings.SettingsAdaptivity.HideDataCellsAtWindowInnerWidth = 500;


    settings.CommandColumn.Visible = true;
    settings.CommandColumn.ShowNewButton = false;
    settings.CommandColumn.ShowEditButton = true;
    settings.CommandColumn.ShowDeleteButton = false;
   

    //Configuración para que la grilla no muestre texto completo
    settings.SettingsBehavior.AllowEllipsisInText = true;
    settings.SettingsResizing.ColumnResizeMode = ColumnResizeMode.NextColumn;


    settings.HtmlRowPrepared = (s, e) =>
    {
        if (Convert.ToDateTime(e.GetValue("FechaFin")).Date > DateTime.Now.Date)
        {
            e.Row.ForeColor = System.Drawing.Color.Black;
        }
        if (Convert.ToDateTime(e.GetValue("FechaFin")).Date < DateTime.Now.Date)
        {
            e.Row.ForeColor = System.Drawing.Color.Red;
        }
        if (Convert.ToDateTime(e.GetValue("FechaFin")).Date == DateTime.Now.Date)
        {
            e.Row.ForeColor = System.Drawing.Color.Orange;
        }
    };
    settings.KeyFieldName = "Secuancial";

    settings.Columns.Add(column =>
    {
        column.EditFormSettings.Visible = DefaultBoolean.False;
        column.FieldName = "Descripcion";
        column.Caption = "Detalle tarea";
        column.Width = Unit.Percentage(65);
        column.EditorProperties().TextBox(sp =>
        {
            sp.Width = Unit.Percentage(100);
        });
    });
    settings.Columns.Add(column =>
    {
        column.EditFormSettings.Visible = DefaultBoolean.False;
        column.FieldName = "FechaInicio";
        column.Caption = "Fecha inicio";
        column.Width = Unit.Percentage(10);
        column.PropertiesEdit.DisplayFormatString = "d";
        column.EditorProperties().DateEdit(sp =>
        {
            column.PropertiesEdit.DisplayFormatString = "d";
            sp.Width = Unit.Percentage(100);
        });
    });
    settings.Columns.Add(column =>
    {
        column.EditFormSettings.Visible = DefaultBoolean.False;
        column.FieldName = "FechaFin";
        column.Caption = "Fecha fin";
        column.Width = Unit.Percentage(10);
        column.PropertiesEdit.DisplayFormatString = "d";
        column.EditorProperties().DateEdit(sp =>
        {
            column.PropertiesEdit.DisplayFormatString = "d";
            sp.Width = Unit.Percentage(100);
        });
    });
    settings.Columns.Add(column =>
    {
        column.EditFormSettings.Visible = DefaultBoolean.True;

        column.FieldName = "IdEstado";
        column.Caption = "Estado";
        column.Width = Unit.Percentage(10);
        column.EditorProperties().ComboBox(p =>
        {
            p.Columns.Add("Descripcion", "Descripcion").Width = Unit.Percentage(70);
            p.ValueField = "IdEstado";
            p.ValueType = typeof(int);
            p.DataSource = ViewBag.list_estado_detalle;
            p.Width = Unit.Percentage(100);
        });
    });
   // settings.Columns.Add("Observacion", "Observación").Width = Unit.Percentage(10);


}).Bind(Model).GetHtml()